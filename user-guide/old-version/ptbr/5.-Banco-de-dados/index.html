



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Awesome PHP Framework with high productivity">
      
      
      
        <meta name="author" content="https://www.thizer.com">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>5. Banco de dados - Suitup Framework</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/application.0284f74d.css">
      
        <link rel="stylesheet" href="../../../../assets/stylesheets/application-palette.01803549.css">
      
      
        
        
        <meta name="theme-color" content="#7e57c2">
      
    
    
      <script src="../../../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../../assets/css/extra-style.css">
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-64023203-5", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="deep-purple" data-md-color-accent="">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#banco-de-dados-mysql" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../../.." title="Suitup Framework" class="md-header-nav__button md-logo">
          
            <i class="md-icon">person_pin_circle</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Suitup Framework
            </span>
            <span class="md-header-nav__topic">
              
                5. Banco de dados
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/braghimsistemas/suitup-php" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    braghimsistemas/suitup-php
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../.." title="User Guide" class="md-tabs__link md-tabs__link--active">
          User Guide
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../troubleshooting/issues/" title="Troubleshooting" class="md-tabs__link">
          Troubleshooting
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../contributors/" title="Contributors" class="md-tabs__link">
          Contributors
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../about/" title="About" class="md-tabs__link">
          About
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../../.." title="Suitup Framework" class="md-nav__button md-logo">
      
        <i class="md-icon">person_pin_circle</i>
      
    </a>
    Suitup Framework
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/braghimsistemas/suitup-php" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    braghimsistemas/suitup-php
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1" checked>
    
    <label class="md-nav__link" for="nav-1">
      User Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        User Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting-started/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting-started/impatients/" title="Tutorial for impatients" class="md-nav__link">
      Tutorial for impatients
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting-started/from-source/" title="Step By Step Tutorial" class="md-nav__link">
      Step By Step Tutorial
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../demo-projects/" title="Demo projects" class="md-nav__link">
      Demo projects
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-6" type="checkbox" id="nav-1-6">
    
    <label class="md-nav__link" for="nav-1-6">
      Reference documents
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-1-6">
        Reference documents
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/overview/" title="Routes" class="md-nav__link">
      Routes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/overview/" title="Controllers & Actions" class="md-nav__link">
      Controllers & Actions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/abstract-controller.md" title="Abstract Controller" class="md-nav__link">
      Abstract Controller
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/overview/" title="Error Controller" class="md-nav__link">
      Error Controller
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/overview/" title="Modules" class="md-nav__link">
      Modules
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/overview/" title="Views & Layouts" class="md-nav__link">
      Views & Layouts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-6-8" type="checkbox" id="nav-1-6-8">
    
    <label class="md-nav__link" for="nav-1-6-8">
      Models (database)
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-1-6-8">
        Models (database)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/overview/" title="Workflow ((IMPORTANT))" class="md-nav__link">
      Workflow ((IMPORTANT))
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/overview/" title="Business" class="md-nav__link">
      Business
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/overview/" title="Gateways" class="md-nav__link">
      Gateways
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/overview/" title="Adapters (help wanted)" class="md-nav__link">
      Adapters (help wanted)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/overview/" title="SQL Queries" class="md-nav__link">
      SQL Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/overview/" title="SQL Monitor" class="md-nav__link">
      SQL Monitor
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/overview/" title="Out of box" class="md-nav__link">
      Out of box
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/overview/" title="Form Validation" class="md-nav__link">
      Form Validation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/overview/" title="Pagination" class="md-nav__link">
      Pagination
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/overview/" title="Functions outstand" class="md-nav__link">
      Functions outstand
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-7" type="checkbox" id="nav-1-7" checked>
    
    <label class="md-nav__link" for="nav-1-7">
      Old Version
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-1-7">
        Old Version
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-7-1" type="checkbox" id="nav-1-7-1" checked>
    
    <label class="md-nav__link" for="nav-1-7-1">
      Português (Brasil)
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-1-7-1">
        Português (Brasil)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../1.-Instalação/" title="1. Instalação" class="md-nav__link">
      1. Instalação
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../1.1-Constantes-padrão/" title="1.1 Constantes padrão" class="md-nav__link">
      1.1 Constantes padrão
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2.-Controllers-e-Views/" title="2. Controllers e Views" class="md-nav__link">
      2. Controllers e Views
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2.1-MvcAbstractController/" title="2.1 MvcAbstractController" class="md-nav__link">
      2.1 MvcAbstractController
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2.2-ErrorController/" title="2.2 ErrorController" class="md-nav__link">
      2.2 ErrorController
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2.3-Paginação/" title="2.3 Paginação" class="md-nav__link">
      2.3 Paginação
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2.4-Debug/" title="2.4 Debug" class="md-nav__link">
      2.4 Debug
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../3.-Layouts/" title="3. Layouts" class="md-nav__link">
      3. Layouts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../4.-Formulários/" title="4. Formulários" class="md-nav__link">
      4. Formulários
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../4.1-Validações/" title="4.1 Validações" class="md-nav__link">
      4.1 Validações
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../4.2-Filtros/" title="4.2 Filtros" class="md-nav__link">
      4.2 Filtros
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../4.3-Validação-Personalizada/" title="4.3 Validação Personalizada" class="md-nav__link">
      4.3 Validação Personalizada
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../4.4-Filtro-Personalizado/" title="4.4 Filtro Personalizado" class="md-nav__link">
      4.4 Filtro Personalizado
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        5. Banco de dados
      </label>
    
    <a href="./" title="5. Banco de dados" class="md-nav__link md-nav__link--active">
      5. Banco de dados
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#banco-de-dados-mysql" title="Banco de dados (Mysql)" class="md-nav__link">
    Banco de dados (Mysql)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#o-que-ha-nesta-pagina" title="O que há nesta página" class="md-nav__link">
    O que há nesta página
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conectando-com-o-banco-de-dados" title="Conectando com o Banco de Dados" class="md-nav__link">
    Conectando com o Banco de Dados
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#estrutura" title="Estrutura" class="md-nav__link">
    Estrutura
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#business-regras-de-negocio" title="Business (Regras de Negócio)" class="md-nav__link">
    Business (Regras de Negócio)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#criando-um-business-bo" title="Criando um Business (BO)" class="md-nav__link">
    Criando um Business (BO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metodos-padrao-de-business" title="Métodos padrão de Business" class="md-nav__link">
    Métodos padrão de Business
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insert-somebo-gtinsertarray-data" title="INSERT - $someBo-&gt;insert(array $data);" class="md-nav__link">
    INSERT - $someBo-&gt;insert(array $data);
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-somebo-gtupdatearray-data-array-where-nowhereforsure-false" title="UPDATE - $someBo-&gt;update(array $data, array $where, $noWhereForSure = false);" class="md-nav__link">
    UPDATE - $someBo-&gt;update(array $data, array $where, $noWhereForSure = false);
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-somebo-gtdeletearray-where" title="DELETE - $someBo-&gt;delete(array $where);" class="md-nav__link">
    DELETE - $someBo-&gt;delete(array $where);
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-somebo-gtgetpk-1" title="GET - $someBo-&gt;get('PK 1');" class="md-nav__link">
    GET - $someBo-&gt;get('PK 1');
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save-somebo-gtsavearray" title="SAVE - $someBo-&gt;save(array());" class="md-nav__link">
    SAVE - $someBo-&gt;save(array());
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gateway" title="Gateway" class="md-nav__link">
    Gateway
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#criando-um-gateway" title="Criando um Gateway" class="md-nav__link">
    Criando um Gateway
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#montar-consultas-complexas" title="Montar consultas complexas" class="md-nav__link">
    Montar consultas complexas
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metodos-para-consultas-sql" title="Métodos para consultas SQL" class="md-nav__link">
    Métodos para consultas SQL
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tipos-de-retorno-de-dados" title="Tipos de retorno de dados" class="md-nav__link">
    Tipos de retorno de dados
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#arquivos-sql" title="Arquivos SQL" class="md-nav__link">
    Arquivos SQL
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#recomendado-para-consultas-simples" title="Recomendado para consultas simples" class="md-nav__link">
    Recomendado para consultas simples
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transacoes" title="Transações" class="md-nav__link">
    Transações
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../5.1-database.config.php/" title="5.1 database.config.php" class="md-nav__link">
      5.1 database.config.php
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../5.2-Monitoramento-de-SQL/" title="5.2 Monitoramento de SQL" class="md-nav__link">
      5.2 Monitoramento de SQL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../6.-Rotas/" title="6. Rotas" class="md-nav__link">
      6. Rotas
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../7.-Funções/" title="7. Funções" class="md-nav__link">
      7. Funções
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-7-2" type="checkbox" id="nav-1-7-2">
    
    <label class="md-nav__link" for="nav-1-7-2">
      English
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-1-7-2">
        English
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../en/1.-Install/" title="1. Install" class="md-nav__link">
      1. Install
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../en/1.1-Default-Constants/" title="1.1 Default Constants" class="md-nav__link">
      1.1 Default Constants
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../en/2.-Controllers-and-Views/" title="2. Controllers and Views" class="md-nav__link">
      2. Controllers and Views
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../en/2.1-MvcAbstractController/" title="2.1 MvcAbstractController" class="md-nav__link">
      2.1 MvcAbstractController
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../en/2.2-ErrorController/" title="2.2 ErrorController" class="md-nav__link">
      2.2 ErrorController
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../en/2.3-Pagination/" title="2.3 Pagination" class="md-nav__link">
      2.3 Pagination
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../en/2.4-Debug/" title="2.4 Debug" class="md-nav__link">
      2.4 Debug
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../en/3.-Layouts/" title="3. Layouts" class="md-nav__link">
      3. Layouts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../en/4.-Forms/" title="4. Forms" class="md-nav__link">
      4. Forms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../en/4.1-Validation/" title="4.1 Validation" class="md-nav__link">
      4.1 Validation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../en/4.2-Filters/" title="4.2 Filters" class="md-nav__link">
      4.2 Filters
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../en/4.3-Personal-Validation/" title="4.3 Personal Validation" class="md-nav__link">
      4.3 Personal Validation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../en/4.4-Personal-Filter/" title="4.4 Personal Filter" class="md-nav__link">
      4.4 Personal Filter
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../en/5.-Database/" title="5. Database" class="md-nav__link">
      5. Database
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../en/5.1-database.config.php/" title="5.1 database.config.php" class="md-nav__link">
      5.1 database.config.php
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../en/5.2-SQL-Monitoring/" title="5.2 SQL Monitoring" class="md-nav__link">
      5.2 SQL Monitoring
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../en/6.-Routes/" title="6. Routes" class="md-nav__link">
      6. Routes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../en/7.-Functions/" title="7. Functions" class="md-nav__link">
      7. Functions
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Troubleshooting
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Troubleshooting
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../troubleshooting/issues/" title="Github Issues" class="md-nav__link">
      Github Issues
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Contributors
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Contributors
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../contributors/" title="How to contribute" class="md-nav__link">
      How to contribute
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      About
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        About
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../about/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../about/compatibility/" title="Comparing to Suitup 1" class="md-nav__link">
      Comparing to Suitup 1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../about/LICENSE/" title="License" class="md-nav__link">
      License
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#banco-de-dados-mysql" title="Banco de dados (Mysql)" class="md-nav__link">
    Banco de dados (Mysql)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#o-que-ha-nesta-pagina" title="O que há nesta página" class="md-nav__link">
    O que há nesta página
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conectando-com-o-banco-de-dados" title="Conectando com o Banco de Dados" class="md-nav__link">
    Conectando com o Banco de Dados
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#estrutura" title="Estrutura" class="md-nav__link">
    Estrutura
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#business-regras-de-negocio" title="Business (Regras de Negócio)" class="md-nav__link">
    Business (Regras de Negócio)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#criando-um-business-bo" title="Criando um Business (BO)" class="md-nav__link">
    Criando um Business (BO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metodos-padrao-de-business" title="Métodos padrão de Business" class="md-nav__link">
    Métodos padrão de Business
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insert-somebo-gtinsertarray-data" title="INSERT - $someBo-&gt;insert(array $data);" class="md-nav__link">
    INSERT - $someBo-&gt;insert(array $data);
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-somebo-gtupdatearray-data-array-where-nowhereforsure-false" title="UPDATE - $someBo-&gt;update(array $data, array $where, $noWhereForSure = false);" class="md-nav__link">
    UPDATE - $someBo-&gt;update(array $data, array $where, $noWhereForSure = false);
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-somebo-gtdeletearray-where" title="DELETE - $someBo-&gt;delete(array $where);" class="md-nav__link">
    DELETE - $someBo-&gt;delete(array $where);
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-somebo-gtgetpk-1" title="GET - $someBo-&gt;get('PK 1');" class="md-nav__link">
    GET - $someBo-&gt;get('PK 1');
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save-somebo-gtsavearray" title="SAVE - $someBo-&gt;save(array());" class="md-nav__link">
    SAVE - $someBo-&gt;save(array());
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gateway" title="Gateway" class="md-nav__link">
    Gateway
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#criando-um-gateway" title="Criando um Gateway" class="md-nav__link">
    Criando um Gateway
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#montar-consultas-complexas" title="Montar consultas complexas" class="md-nav__link">
    Montar consultas complexas
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metodos-para-consultas-sql" title="Métodos para consultas SQL" class="md-nav__link">
    Métodos para consultas SQL
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tipos-de-retorno-de-dados" title="Tipos de retorno de dados" class="md-nav__link">
    Tipos de retorno de dados
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#arquivos-sql" title="Arquivos SQL" class="md-nav__link">
    Arquivos SQL
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#recomendado-para-consultas-simples" title="Recomendado para consultas simples" class="md-nav__link">
    Recomendado para consultas simples
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transacoes" title="Transações" class="md-nav__link">
    Transações
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>5. Banco de dados</h1>
                
                <h3 id="banco-de-dados-mysql">Banco de dados (Mysql)<a class="headerlink" href="#banco-de-dados-mysql" title="Permanent link">&para;</a></h3>
<blockquote>
<p>Tudo bem, este artigo é um pouco grande, nós entendemos. Mas é realmente necessário que você leia e compreenda tudo, para assim poder ter certeza de que está fazendo seu aplicativo funcionar corretamente. Valos lá, você já leu artigos maiores e muito menos interessantes...</p>
</blockquote>
<p>Até este momento nós incluímos no <em>SuitUp</em> somente o banco de dados mais famoso do mundo (<a href="//mysql.com">MySql da Oracle</a>). Nós não temos absolutamente nada contra nenhum outro tipo de banco de dados, muito pelo contrário, as opções são muitas e cada um tem seus pontos fortes a oferecer. Talvez você queira utilizar outro tipo de banco de dados e pense que por isso não é possível utilizar o <em>SuitUp</em>, mas a verdade é que com poucas adaptações é possível integrar outro módulo de banco de dados. Mesmo assim não vamos entrar neste assunto sem antes existir demanda pra isso.</p>
<h3 id="o-que-ha-nesta-pagina">O que há nesta página<a class="headerlink" href="#o-que-ha-nesta-pagina" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="#conectando-com-o-banco-de-dados">Conectando com o banco de dados</a></li>
<li><a href="#estrutura">Estrutura</a></li>
<li><a href="#business-regras-de-neg%C3%B3cio">Business (Regras de Negócio)</a></li>
<li><a href="#criando-um-business-bo">Criando um Business (BO)</a></li>
<li><a href="#m%C3%A9todos-padr%C3%A3o-de-business">Métodos padrão de Business</a></li>
<li><a href="#insert---somebo-insertarray-data">INSERT</a></li>
<li><a href="#update---somebo-updatearray-data-array-where-nowhereforsure--false">UPDATE</a></li>
<li><a href="#delete---somebo-deletearray-where">DELETE</a></li>
<li><a href="#get---somebo-getpk-1">GET</a></li>
<li><a href="#save---somebo-savearray">SAVE</a></li>
<li><a href="#gateway">Gateway</a></li>
<li><a href="#criando-um-gateway">Criando um Gateway</a></li>
<li><a href="#montar-consultas-complexas">Montar consultas complexas</a></li>
<li><a href="#m%C3%A9todos-para-consultas-sql">Métodos para consultas SQL</a></li>
<li><a href="#tipos-de-retorno-de-dados">Tipos de retorno de dados</a></li>
<li><a href="#arquivos-sql">Arquivos SQL</a></li>
<li><a href="#transa%C3%A7%C3%B5es">Transações</a></li>
</ul>
<hr />
<h4 id="conectando-com-o-banco-de-dados">Conectando com o Banco de Dados<a class="headerlink" href="#conectando-com-o-banco-de-dados" title="Permanent link">&para;</a></h4>
<p>Antes de começar a utilizar seu banco de dados via <em>SuitUp</em> você precisa incluir ao projeto as configurações para realizar a conexão com ele. Para isso nós fizemos [[este manual|5.1 database.config.php]] que irá explicar tudo que você precisa fazer para realizar esta conexão.</p>
<p>[[Manual para conexão com seu banco de dados MySql|5.1 database.config.php]]</p>
<h4 id="estrutura">Estrutura<a class="headerlink" href="#estrutura" title="Permanent link">&para;</a></h4>
<p>Dentro de cada módulo deve haver uma pasta <code>Model</code> com a seguinte estrutura</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">ModuleName</span>
<span class="err">|</span>  <span class="n">Model</span>
<span class="err">|</span>  <span class="err">|</span>  <span class="n">Gateway</span>
<span class="err">|</span>  <span class="err">|</span>  <span class="err">|</span>  <span class="n">User</span><span class="p">.</span><span class="n">php</span>
<span class="err">|</span>  <span class="err">|</span>  <span class="n">SqlFiles</span> <span class="p">(</span><span class="n">opcional</span><span class="p">)</span>
<span class="err">|</span>  <span class="err">|</span>  <span class="err">|</span>  <span class="n">user</span>
<span class="err">|</span>  <span class="err">|</span>  <span class="err">|</span>  <span class="err">|</span>  <span class="n">getById</span><span class="p">.</span><span class="n">sql</span>
<span class="err">|</span>  <span class="err">|</span>  <span class="n">UserBusiness</span><span class="p">.</span><span class="n">php</span>
</pre></div>
</td></tr></table>

<blockquote>
<p>Os arquivos demonstrados na estrutura acima são representativos, ou seja, servem apenas de exemplos.</p>
</blockquote>
<h3 id="business-regras-de-negocio">Business (Regras de Negócio)<a class="headerlink" href="#business-regras-de-negocio" title="Permanent link">&para;</a></h3>
<p>Esta é uma estrutura interessante de projeto que evita problemas como perder ou pular uma regra de negócio, como? Um controlador nunca deve acessar um <code>Gateway</code>, esta é a classe que efetiva as consultas no banco de dados. Em vez disso um controlador ou qualquer outro lugar do sistema deve acessar sempre um <code>Business</code> (BO, BusinessObject) que deve retornar resultados do banco de dados, mas aplicando regras de negócio.</p>
<p>Para entender melhor, vamos supor que você tenha uma regra de negócio em seu projeto que ao excluir um usuário também apaga todos os pedidos feito por ele. Se você acessar o <code>Gateway</code> diretamente para excluir este usuário ele será excluído e deixará os pedidos sem serem excluídos, dessa forma você garante que a regra de negócio será sempre aplicada. Claro que o programador pode pular esta estrutura se desejar, esta é a maneira que nós recomendamos.</p>
<p><strong>IMPORTANTE:</strong> Nunca deixe um <code>Business</code> chamar um método de outro <code>Gateway</code> que não é o dele, isto também seria uma quebra de regras de negócio. <em><code>Business</code> só se comunica com <code>Business</code></em></p>
<h4 id="criando-um-business-bo">Criando um Business (BO)<a class="headerlink" href="#criando-um-business-bo" title="Permanent link">&para;</a></h4>
<p>Lembre-se, cada tabela do banco de dados deve ter sua <code>Business</code> e sua <code>Gateway</code>. Para criar a <code>Business</code> de uma tabela basta estendê-la de <code>\SuitUp\Database\Business\AbstractBusiness</code> e criar um atributo <code>protected</code> de nome <code>$gateway</code>. Os métodos ficam por sua necessidade.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="x">namespace ModuleName\Model</span>

<span class="x">use \SuitUp\Database\Business\AbstractBusiness;</span>

<span class="x">class UserBusiness extends AbstractBusiness</span>
<span class="x">{</span>
<span class="x">    /**</span>
<span class="x">     * Atributo obrigatório  </span>
<span class="x">     * @var Gateway\User</span>
<span class="x">     */</span>
<span class="x">    protected $gateway;</span>

<span class="x">    /**</span>
<span class="x">     * EXEMPLO.</span>
<span class="x">     * Retorna o nome do usuário.</span>
<span class="x">     * </span>
<span class="x">     * @param int $userId ID do usuário</span>
<span class="x">     * @return string</span>
<span class="x">     */</span>
<span class="x">    public function userNameById($userId) {</span>
<span class="x">        // Note aqui a regra de negócio sendo aplicada.</span>
<span class="x">        $result = $this-&gt;gateway-&gt;getUserById($userId);</span>
<span class="x">        return $result[&#39;name&#39;];</span>
<span class="x">    }</span>
<span class="x">}</span>
</pre></div>
</td></tr></table>

<h4 id="metodos-padrao-de-business">Métodos padrão de <code>Business</code><a class="headerlink" href="#metodos-padrao-de-business" title="Permanent link">&para;</a></h4>
<p>Todas as <code>Business</code> vêm por padrão com os seguintes métodos. São ações muito comuns de serem necessárias que não precisam ser reescritas. Lembre-se de que para que esses métodos funcionem é necessário também criar a respectiva classe <code>Gateway</code> para a mesma tabela.</p>
<h4 id="insert-somebo-gtinsertarray-data">INSERT - <code>$someBo-&gt;insert(array $data);</code><a class="headerlink" href="#insert-somebo-gtinsertarray-data" title="Permanent link">&para;</a></h4>
<p>Este método realiza somente o <code>INSERT</code> no banco de dados e retorna o ID (<a href="//php.net/function.mysql-insert-id"><code>last insert ID</code></a>) gerado para a tabela.</p>
<p>Exemplo:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="x">// Apenas um exemplo</span>
<span class="x">try {</span>

<span class="x">    // Insert</span>
<span class="x">    $userBo = new \ModuleDefault\Model\UserBusiness();</span>
<span class="x">    $newId = $userBo-&gt;insert(array(</span>
<span class="x">        &#39;name&#39; =&gt; &#39;Braghim Sistemas&#39;,</span>
<span class="x">        &#39;email&#39; =&gt; &#39;braghim.sistemas@gmail.com&#39;,</span>
<span class="x">    ));</span>
<span class="x">} catch (\Exception $e) {</span>
<span class="x">    // Error control</span>
<span class="x">}</span>
</pre></div>
</td></tr></table></p>
<hr />
<h4 id="update-somebo-gtupdatearray-data-array-where-nowhereforsure-false">UPDATE - <code>$someBo-&gt;update(array $data, array $where, $noWhereForSure = false);</code><a class="headerlink" href="#update-somebo-gtupdatearray-data-array-where-nowhereforsure-false" title="Permanent link">&para;</a></h4>
<p>Este método realiza somente o <code>UPDATE</code> no banco de dados e retorna o número de linhas alteradas com isso. O parâmetro <code>$noWhereForSure</code> ativado (true) significa que o parâmetro <code>$where</code> foi passado vazio de propósito, pois isso significa que o <code>UPDATE</code> irá alterar todos os registros da tabela, o que não é de modo algum algo comum.</p>
<p>Exemplo:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="x">// Apenas um exemplo</span>
<span class="x">try {</span>

<span class="x">    $data = array(</span>
<span class="x">        &#39;name&#39; =&gt; &#39;Braghim Sistemas&#39;,</span>
<span class="x">        &#39;email&#39; =&gt; &#39;braghim.sistemas@gmail.com&#39;,</span>
<span class="x">    );</span>

<span class="x">    // Update</span>
<span class="x">    $userBo = new \ModuleDefault\Model\UserBusiness();</span>
<span class="x">    $newId = $userBo-&gt;update($data, array(&#39;pk&#39; =&gt; 1));</span>

<span class="x">} catch (\Exception $e) {</span>
<span class="x">    // Error control</span>
<span class="x">}</span>
</pre></div>
</td></tr></table></p>
<hr />
<h4 id="delete-somebo-gtdeletearray-where">DELETE - <code>$someBo-&gt;delete(array $where);</code><a class="headerlink" href="#delete-somebo-gtdeletearray-where" title="Permanent link">&para;</a></h4>
<p>Este método remove efetivamente um registro do banco de dados e retorna o número de linhas afetadas.</p>
<p>Exemplo:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="x">// Apenas um exemplo</span>
<span class="x">try {</span>

<span class="x">    // Update</span>
<span class="x">    $userBo = new \ModuleDefault\Model\UserBusiness();</span>
<span class="x">    $newId = $userBo-&gt;delete(array(&#39;pk&#39; =&gt; 1));</span>

<span class="x">} catch (\Exception $e) {</span>
<span class="x">    // Error control</span>
<span class="x">}</span>
</pre></div>
</td></tr></table>
Caso você tenha necessidade de fazer delete lógico, ou seja, utilizar <code>status</code> para identificar registros removidos em vez de removê-los de fato será necessário implementar seu próprio método.</p>
<hr />
<h5 id="get-somebo-gtgetpk-1">GET - <code>$someBo-&gt;get('PK 1');</code><a class="headerlink" href="#get-somebo-gtgetpk-1" title="Permanent link">&para;</a></h5>
<p>Este método irá retornar o item da tabela do banco de dados que tem este(s) ID('s). Você verá mais adiante que ao criar um <code>Gateway</code> você deverá indicar o(s) ID('s) da tabela, assim o <em>SuitUp</em> sabe quais registros procurar.</p>
<p>Se sua tabela trabalha com chaves compostas (varias colunas como chave primária) será necessário passar todas elas como parâmetros separados.</p>
<p>Exemplo:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="x">// Apenas um exemplo</span>
<span class="x">$userBo = new \ModuleDefault\Model\UserBusiness();</span>
<span class="x">$user = $userBo-&gt;get(1, &#39;active&#39;);</span>
</pre></div>
</td></tr></table></p>
<hr />
<h5 id="save-somebo-gtsavearray">SAVE - <code>$someBo-&gt;save(array());</code><a class="headerlink" href="#save-somebo-gtsavearray" title="Permanent link">&para;</a></h5>
<p>Este método identifica se é necessário fazer um <code>insert</code> ou <code>update</code> no banco de dados automaticamente, serve na realidade como apelido para ambos. <strong>Para identificar qual método o <em>SuitUp</em> irá utilizar, este método verifica se no <code>array</code> existem as chaves primárias da tabela e se existirem faz um <code>update</code>, caso contrário será um <code>insert</code>.</strong></p>
<p>Exemplo:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="x">// Apenas um exemplo</span>
<span class="x">try {</span>

<span class="x">    // Insert</span>
<span class="x">    $userBo = new \ModuleDefault\Model\UserBusiness();</span>
<span class="x">    $newId = $userBo-&gt;save(array(</span>
<span class="x">        &#39;name&#39; =&gt; &#39;Braghim Sistemas&#39;,</span>
<span class="x">        &#39;email&#39; =&gt; &#39;braghim.sistemas@gmail.com&#39;,</span>
<span class="x">    ));</span>

<span class="x">    // Update</span>
<span class="x">    $userBo = new \ModuleDefault\Model\UserBusiness();</span>
<span class="x">    $userBo-&gt;save(array(</span>
<span class="x">        &#39;pk&#39; =&gt; $newId,</span>
<span class="x">        &#39;name&#39; =&gt; &#39;Braghim Sistemas&#39;,</span>
<span class="x">        &#39;email&#39; =&gt; &#39;braghim.sistemas@gmail.com&#39;,</span>
<span class="x">    ));</span>

<span class="x">} catch (\Exception $e) {</span>
<span class="x">    // Error</span>
<span class="x">}</span>
</pre></div>
</td></tr></table></p>
<hr />
<h3 id="gateway">Gateway<a class="headerlink" href="#gateway" title="Permanent link">&para;</a></h3>
<p>São os <code>gateways</code> que vão de fato realizar as consultas no banco de dados, você pode criar queries (SQL) por Objeto, String e até mesmo por arquivos (.sql).</p>
<h4 id="criando-um-gateway">Criando um Gateway<a class="headerlink" href="#criando-um-gateway" title="Permanent link">&para;</a></h4>
<p>Um <code>Gateway</code> deve obrigatoriamente conter os atributos <code>$name</code> e <code>$primary</code> onde o primeiro deve ser uma string com o nome da tabela (pode conter o nome do banco como <code>db_main.tb_user</code> por exemplo) e o segundo pode ser uma string com o nome da PK, mas preferencialmente um array com a lista dele(s).</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="x">namespace ModuleDefault\Model\Gateway</span>

<span class="x">use \SuitUp\Database\Gateway\AbstractGateway;</span>

<span class="x">class User extends AbstractGateway {</span>

<span class="x">    /**</span>
<span class="x">     * Defina aqui o nome da tabela e o nome da(s) chave(s) primária(s).</span>
<span class="x">     * Isto é obrigatório.</span>
<span class="x">     */</span>
<span class="x">    protected $name = &#39;user&#39;;</span>
<span class="x">    protected $primary = array(&#39;id_user&#39;);</span>

<span class="x">    /**</span>
<span class="x">     * Opcionalmente você pode indicar uma coluna que a cada update receberá um update</span>
<span class="x">     * automático sem que você precise indicar na chamada do método update();</span>
<span class="x">     */</span>
<span class="x">    protected $onUpdate = array(&#39;edit&#39; =&gt; &#39;NOW()&#39;);</span>

<span class="x">    /**</span>
<span class="x">     * Sql por Objeto. Este é o método que nós recomendamos em primeiro lugar,</span>
<span class="x">         * mais seguro e mais fácil de dar manutenção</span>
<span class="x">     */</span>
<span class="x">    public function getUserByIdObject($userId) {</span>
<span class="x">        $sql = $this-&gt;select(&quot;SELECT * FROM user&quot;)</span>
<span class="x">            -&gt;where(&quot;pk_user = ?&quot;, $userId);</span>

<span class="x">        return $this-&gt;db-&gt;row($sql);</span>
<span class="x">    }</span>

<span class="x">    /**</span>
<span class="x">     * Sql por String.</span>
<span class="x">     */</span>
<span class="x">    public function getUserByIdString($userId) {</span>
<span class="x">        $sql = &quot;SELECT * FROM user WHERE pk_user = :user&quot;;</span>

<span class="x">        return $this-&gt;db-&gt;row($sql, array(</span>
<span class="x">            &#39;user&#39; =&gt; $userId</span>
<span class="x">        ));</span>
<span class="x">    }</span>

<span class="x">    /** Utilize este apenas em queries pequenas e simples.</span>
<span class="x">     * Arquivo SQL que vai estar em ModuleDefault/Model/SqlFiles/user/getById.sql</span>
<span class="x">         * este caminho é encontrado automaticamente pelo caminho até o model.</span>
<span class="x">     */</span>
<span class="x">    public function getUserById($userId) {</span>
<span class="x">        $sql = $this-&gt;sqlFile(&#39;getById&#39;);</span>

<span class="x">        return $this-&gt;db-&gt;row($sql, array(</span>
<span class="x">            &#39;user&#39; =&gt; $userId</span>
<span class="x">        ));</span>
<span class="x">    }</span>
<span class="x">}</span>
</pre></div>
</td></tr></table>

<h3 id="montar-consultas-complexas">Montar consultas complexas<a class="headerlink" href="#montar-consultas-complexas" title="Permanent link">&para;</a></h3>
<p>Ao montar uma consulta mais complexa nós recomendamos utilizar os <strong>objetos</strong> como <code>$this-&gt;select('SELECT * FROM ...');</code>. Esta é a forma mais segura e mais fácil de dar manutenção depois, além também de facilitar para montar a consulta quando esta tem questões condicionais como filtros.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">namespace</span> <span class="nx">ModuleDefault\ModelMain\Gateway</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">SuitUp\Database\Gateway\AbstractGateway</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Phone</span> <span class="k">extends</span> <span class="nx">AbstractGateway</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$name</span> <span class="o">=</span> <span class="s1">&#39;maindb.tb_phone&#39;</span><span class="p">;</span> <span class="c1">// database + table</span>
    <span class="k">protected</span> <span class="nv">$primary</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;id_phone&#39;</span><span class="p">);</span>

    <span class="sd">/**</span>
<span class="sd">     * Lista os telefones de um usuario</span>
<span class="sd">     * </span>
<span class="sd">     * @param int $idRegion</span>
<span class="sd">     * @param array $filters</span>
<span class="sd">     * @return \SuitUp\Paginate\Paginate</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">listphonesByRegion</span><span class="p">(</span><span class="nv">$idRegion</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$filters</span> <span class="o">=</span> <span class="k">array</span><span class="p">())</span> <span class="p">{</span>

        <span class="c1">// Subquery retorna o número de atendentes em cada telefone da regiao</span>
        <span class="nv">$subQuery</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s2">&quot;SELECT COUNT(1) FROM otherdb.tb_operator op1&quot;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;p.id_phone = op1.id_phone&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;op1.status = 1&#39;</span><span class="p">);</span>

        <span class="nv">$query</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s2">&quot;SELECT p.* FROM </span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span><span class="si">}</span><span class="s2"> as p&quot;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">columns</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;p.id_phone&#39;</span><span class="p">,</span>
                <span class="s1">&#39;p.country&#39;</span><span class="p">,</span>
                <span class="s1">&#39;p.area_code&#39;</span><span class="p">,</span>
                <span class="s1">&#39;p.number&#39;</span><span class="p">,</span>
                <span class="s1">&#39;r.id_region&#39;</span><span class="p">,</span>
                <span class="s1">&#39;r.state&#39;</span><span class="p">,</span>
                <span class="s1">&#39;r.city&#39;</span><span class="p">,</span>
                <span class="s1">&#39;r.neighborhood&#39;</span><span class="p">,</span>
                <span class="s2">&quot;(</span><span class="si">$subQuery</span><span class="s2">)&quot;</span> <span class="o">=&gt;</span> <span class="s1">&#39;qtdOps&#39;</span><span class="p">,</span> <span class="c1">// Subquery</span>
            <span class="p">))</span>
            <span class="o">-&gt;</span><span class="na">innerJoin</span><span class="p">(</span><span class="s2">&quot;maindb.tb_region as r&quot;</span><span class="p">,</span> <span class="s2">&quot;r.id_region = p.id_region&quot;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;r.id_region = ?&#39;</span><span class="p">,</span> <span class="nv">$idRegion</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;r.status = 1&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s2">&quot;(</span><span class="si">$subQuery</span><span class="s2">) &gt; 0&quot;</span><span class="p">)</span> <span class="c1">// Subquery &gt; 0</span>
            <span class="o">-&gt;</span><span class="na">order</span><span class="p">(</span><span class="s2">&quot;u.`name` ASC&quot;</span><span class="p">);</span>

        <span class="c1">// Filtro por regiao (estado)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$filters</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$filters</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">])</span> <span class="p">{</span>
            <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;UPPER(r.state) LIKE UPPER(?)&#39;</span><span class="p">,</span> <span class="s1">&#39;%&#39;</span><span class="o">.</span><span class="nv">$filters</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">.</span><span class="s1">&#39;%&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// Retornando dados paginados</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db</span><span class="o">-&gt;</span><span class="na">paginate</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h3 id="metodos-para-consultas-sql">Métodos para consultas <code>SQL</code><a class="headerlink" href="#metodos-para-consultas-sql" title="Permanent link">&para;</a></h3>
<p>De fato, para quem está habituado a escrever consultas para banco de dados estes métodos seguintes dispensam qualquer tipo de apresentação.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="x">public function columns(array $columns)</span>

<span class="x">public function innerJoin($table, $onClause)</span>

<span class="x">public function leftJoin($table, $onClause)</span>

<span class="x">public function rightJoin($table, $onClause)</span>

<span class="x">public function where($where, $value = null, $type = null)</span>

<span class="x">public function orWhere($where, $value = null, $type = null)</span>

<span class="x">public function group($column)</span>

<span class="x">public function order($column)</span>

<span class="x">public function having($text);</span>

<span class="x">public function limit($limit, $offset = null);</span>
</pre></div>
</td></tr></table>

<h3 id="tipos-de-retorno-de-dados">Tipos de retorno de dados<a class="headerlink" href="#tipos-de-retorno-de-dados" title="Permanent link">&para;</a></h3>
<p>É possível escolher como a consulta vai retornar resultados, em array para várias linhas ao mesmo tempo, apenas uma linha, apenas um valor sem nome ou até mesmo em pares do tipo <code>id =&gt; valor</code>. São esses métodos:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="x">// Retorna lista com várias linhas do banco de dados (de acordo com a consulta)</span>
<span class="x">$this-&gt;db-&gt;query($query, $params = null, $fetchmode = \PDO::FETCH_ASSOC);</span>

<span class="x">// Retorna apenas as colunas indicadas por número (começando por 0 [zero])</span>
<span class="x">$this-&gt;db-&gt;column($query, $params = null);</span>

<span class="x">// Retorna apenas a primeira linha do resultado segundo a consulta</span>
<span class="x">$this-&gt;db-&gt;row($query, $params = null, $fetchmode = \PDO::FETCH_ASSOC);</span>

<span class="x">// Retorna um único resultado sem nem mesmo nome de coluna</span>
<span class="x">$this-&gt;db-&gt;single($query, $params = null);</span>
</pre></div>
</td></tr></table>

<p>Os métodos acima são aqueles que nós julgamos que sejam mais necessários e utilizados para o dia-a-dia, mas é possível escolher o <code>\PDO::FETCH_*</code> necessário que o PHP disponibiliza <a href="http://php.net/manual/pt_BR/pdostatement.fetch.php">aqui</a>. Neste caso utilize da seguinte forma:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="x">$this-&gt;db-&gt;query($query, $params = null, $fetchmode = \PDO::FETCH_ASSOC);</span>
</pre></div>
</td></tr></table>

<h3 id="arquivos-sql">Arquivos <code>SQL</code><a class="headerlink" href="#arquivos-sql" title="Permanent link">&para;</a></h3>
<h4 id="recomendado-para-consultas-simples">Recomendado para consultas <em>simples</em><a class="headerlink" href="#recomendado-para-consultas-simples" title="Permanent link">&para;</a></h4>
<p>Para montar a consulta por meio de arquivo SQL você deve simplesmente seguir as regras SQL para a instrução desejada, nós pegamos o conteúdo deste arquivo, substituímos os valores e rodamos ela no banco de dados exatamente como você a montou. O que complica é que quando você precisar adicionar instruções condicionalmente como filtros fica muito difícil fazer isso simplesmente com SQL e sem programação, por isso indicamos este método de arquivos <code>.sql</code> apenas para consultas simples. </p>
<blockquote>
<p>Os parâmetros da consulta devem ser precedidos do <code>:</code></p>
</blockquote>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="k">user</span> <span class="n">u</span> <span class="k">WHERE</span> <span class="n">u</span><span class="p">.</span><span class="n">pk_user</span> <span class="o">=</span> <span class="p">:</span><span class="k">user</span>
</pre></div>
</td></tr></table>

<h3 id="transacoes">Transações<a class="headerlink" href="#transacoes" title="Permanent link">&para;</a></h3>
<p>A qualquer momento você pode iniciar uma transação no banco de dados. As transações fazem com que as ações realizadas no escopo depois de <code>begin</code> só tenham efeito após um <code>commit</code>, ou seja, se houver um <code>rollBack</code> nada será alterado no banco. É uma forma de garantir a persistência dos dados e não realizar ações pela metade, causando assim inconsistência nos dados do banco. Veja abaixo um exemplo na prática.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="x">\SuitUp\Database\Database::beginTransaction();</span>
<span class="x">try {</span>

<span class="x">    $phoneBo = new \ModuleDefault\ModelLogs\PhoneBusiness();</span>
<span class="x">    $newPhone = $phoneBo-&gt;insert(array(</span>
<span class="x">        &#39;country&#39; =&gt; &#39;+55&#39;,</span>
<span class="x">        &#39;area_code&#39; =&gt; &#39;85&#39;,</span>
<span class="x">        &#39;number&#39; =&gt; &#39;555-5555&#39;,</span>
<span class="x">    ));</span>

<span class="x">    // Erro absurdo</span>
<span class="x">    if ($newPhone%2 == 0) {</span>
<span class="x">        throw new \Exception(&quot;Arbitrary error&quot;);</span>
<span class="x">    }</span>

<span class="x">    // Não caiu no erro absurdo, agora sim o banco vai gravar este valor</span>
<span class="x">    \SuitUp\Database\Database::commit();</span>

<span class="x">} catch(\Exception $e) {</span>

<span class="x">    // Nada foi alterado</span>
<span class="x">    \SuitUp\Database\Database::rollBack();</span>
<span class="x">}</span>
</pre></div>
</td></tr></table>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../4.4-Filtro-Personalizado/" title="4.4 Filtro Personalizado" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                4.4 Filtro Personalizado
              </span>
            </div>
          </a>
        
        
          <a href="../5.1-database.config.php/" title="5.1 database.config.php" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                5.1 database.config.php
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 Braghim Sistemas
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/braghimsistemas" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://www.youtube.com/channel/UCnQKkBQpuqSqTIWN0XGgAlQ" class="md-footer-social__link fa fa-youtube"></a>
    
      <a href="https://www.facebook.com/braghimsistemas/" class="md-footer-social__link fa fa-facebook"></a>
    
      <a href="https://github.com/marcobraghim" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://github.com/thizer" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://www.youtube.com/channel/UCwoZZYTjG-RsvaQZVTyc_5w" class="md-footer-social__link fa fa-youtube"></a>
    
      <a href="https://www.facebook.com/thizer.apps/" class="md-footer-social__link fa fa-facebook"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../../.."}})</script>
      
    
  </body>
</html>